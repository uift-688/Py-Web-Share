<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Share</title>
</head>
<body>
    <h1>QR Share</h1>
    <input type="file" id="fileInput">
    <button onclick="generateQRCode()">共有</button>
    <button id="downloadButton">ダウンロード</button>
    <canvas id="qrcodeCanvas" width="250" height="250"></canvas>

    <!-- QRコードライブラリの読み込み -->
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script>
        function generateQRCode() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // データのGzip圧縮
                    const compressedData = pako.gzip(new Uint8Array(e.target.result));
                    const base64String = btoa(
                        new Uint8Array(compressedData)
                            .reduce((data, byte) => data + String.fromCharCode(byte), '')
                    );
                    const mimeType = file.type;
                    const dataURL = `data:${mimeType};base64,${base64String}`;
                    const qrcodeCanvas = document.getElementById('qrcodeCanvas');

                    if (qrcodeCanvas && qrcodeCanvas.getContext) {
                        // QRコードの生成
                        QRCode.toCanvas(qrcodeCanvas, dataURL, function (error) {
                            if (error) {
                                console.error(error);
                                alert('QRコード生成エラー: データが大きすぎます。');
                            } else {
                                console.log('QRコードが正常に生成されました。');
                            }
                        });
                    } else {
                        console.error('QRコード生成エラー: <canvas>要素が見つからないか、無効です。');
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        }
    </script>
</body>
</html>
